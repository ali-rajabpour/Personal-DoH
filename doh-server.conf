# doh-server.conf

# HTTP Listen Port (Internal container port)
listen = [
    ":8053",
]

# TLS is handled by Traefik, so we leave cert/key empty here
cert = ""
key = ""

# Path for the DoH query (must match your Traefik PathPrefix)
path = "/dns-query"

# --- 1. TRIPLE UPSTREAM CONFIGURATION ---
# We define your 3 requested providers: NextDNS, AdGuard, and Cloudflare.
# The server will pick one based on the selector below.
upstream = [
    "udp:45.90.28.47:53",  # NextDNS
    "udp:94.140.14.14:53", # AdGuard DNS
    "udp:1.1.1.1:53"       # Cloudflare
]

# --- 3. PERFORMANCE TUNING ---
# 'weighted_round_robin' allows distributing load.
# 'random' is faster for simple failover logic.
# If you want to prioritize NextDNS but fall back to others, give it a higher weight:
upstream_selector = "weighted_round_robin"

# Weight corresponds to the order in the 'upstream' list above.
# Example: NextDNS (50), AdGuard (25), Cloudflare (25)
# This sends 50% of traffic to NextDNS, splitting the rest.
weight = [ 50, 25, 25 ]

# Timeout in seconds. Lowering this (e.g. to 3-5s) forces faster failover if a server hangs.
timeout = 5

# Number of retries if an upstream fails.
tries = 3

# verbose = false saves CPU cycles by not logging every single request
verbose = false
