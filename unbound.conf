server:
    # --- Network ---
    interface: 0.0.0.0@53
    do-ip4: yes
    do-ip6: no
    do-udp: yes
    do-tcp: yes

    # --- Access control (Docker internal only) ---
    access-control: 10.0.0.0/8 allow
    access-control: 172.16.0.0/12 allow
    access-control: 192.168.0.0/16 allow
    access-control: 127.0.0.0/8 allow

    # --- Logging (minimal) ---
    verbosity: 0
    val-log-level: 0
    log-queries: no
    log-replies: no
    log-local-actions: no
    log-servfail: yes

    # --- Threading ---
    num-threads: 2
    msg-cache-slabs: 4
    rrset-cache-slabs: 4
    infra-cache-slabs: 4
    key-cache-slabs: 4

    # --- Cache sizes (aggressive) ---
    msg-cache-size: 64m
    rrset-cache-size: 128m
    key-cache-size: 16m
    neg-cache-size: 8m

    # --- Cache TTL ---
    cache-min-ttl: 300
    cache-max-ttl: 86400
    cache-max-negative-ttl: 600

    # --- Prefetching ---
    # Refreshes popular cache entries BEFORE they expire.
    # When an entry is at 10% remaining TTL, a background fetch is triggered.
    # Users never see a cache miss for frequently-queried domains.
    prefetch: yes
    prefetch-key: yes

    # --- Serve expired (instant stale response + background refresh) ---
    # Returns stale cached data immediately, then refreshes in the background.
    # Eliminates perceived latency even on TTL expiry.
    serve-expired: yes
    serve-expired-ttl: 86400
    serve-expired-reply-ttl: 30

    # --- Privacy ---
    qname-minimisation: yes

    # --- Hardening ---
    hide-identity: yes
    hide-version: yes
    harden-glue: yes
    harden-dnssec-stripped: yes
    harden-algo-downgrade: yes
    use-caps-for-id: no

    # --- Performance ---
    so-reuseport: yes
    edns-buffer-size: 1232
    so-rcvbuf: 4m
    so-sndbuf: 4m
    outgoing-range: 8192
    num-queries-per-thread: 4096

    # --- Forwarding mode (no local DNSSEC validation) ---
    module-config: "iterator"

    # --- Private addresses (don't leak reverse lookups) ---
    private-address: 10.0.0.0/8
    private-address: 172.16.0.0/12
    private-address: 192.168.0.0/16
    private-address: 169.254.0.0/16
    private-address: fd00::/8
    private-address: fe80::/10

# --- Forward all queries to dnscrypt-proxy ---
forward-zone:
    name: "."
    forward-addr: 10.53.0.10@5353
    forward-first: no
